//
// Generated by JSON2Apex http://json2apex.herokuapp.com/
//

public class FacebookPlaces {	
	public List<FacebookPlace> data {get;set;}
	public FacebookPaging paging {get;set;}

	public FacebookPlaces(JSONParser parser) {
		while (parser.nextToken() != JSONToken.END_OBJECT) {
			if (parser.getCurrentToken() == JSONToken.FIELD_NAME) {
				String text = parser.getText();
				if (parser.nextToken() != JSONToken.VALUE_NULL) {
					if (text == 'data') {
						data = new List<FacebookPlace>();
						while (parser.nextToken() != JSONToken.END_ARRAY) {
							data.add(new FacebookPlace(parser));
						}
					} else if (text == 'paging') {
						paging = new FacebookPaging(parser);
					} else {
						System.debug(LoggingLevel.WARN, 'Root consuming unrecognized property: '+text);
						FacebookUtil.consumeObject(parser);
					}
				}
			}
		}
	}
	
	public FacebookPlaces(String accessToken, String id, Map<String, String> params) {
		this(System.JSON.createParser(FacebookUtil.get(accessToken, id, params)));
	}
	
	public FacebookPlaces(String accessToken, String id) {
		this(accessToken, id, null);
	}
	
	public static FacebookPlaces parse(String json) {
		return new FacebookPlaces(System.JSON.createParser(json));
	}
	
	public static FacebookPlaces search(String accessToken, String query, Map<String, String> params) {
		if (params == null) {
			params = new Map<String, String>();
		}
		params.put('q', EncodingUtil.urlEncode(query, 'UTF-8'));
		params.put('type', 'place');
		
		return new FacebookPlaces(System.JSON.createParser(FacebookUtil.get(accessToken, 'search', params)));
	}
	
	public static FacebookPlaces search(String accessToken, String query) {
		return search(accessToken, query, null);
	}
	
	// This test method should give 100% coverage
	static testMethod void testParse() {
		String json = '{'+
		'   \"data\": ['+
		'      {'+
		'         \"name\": \"Philz Coffee\",'+
		'         \"category\": \"Local business\",'+
		'         \"location\": {'+
		'            \"street\": \"4023 18th St\",'+
		'            \"city\": \"San Francisco\",'+
		'            \"state\": \"CA\",'+
		'            \"country\": \"United States\",'+
		'            \"zip\": \"94114-2501\",'+
		'            \"latitude\": 37.760876096373,'+
		'            \"longitude\": -122.43272191478'+
		'         },'+
		'         \"id\": \"151116474914629\"'+
		'      },'+
		'      {'+
		'         \"name\": \"Ritual Coffee Roasters\",'+
		'         \"category\": \"Restaurant/cafe\",'+
		'         \"location\": {'+
		'            \"street\": \"1026 Valencia Street\",'+
		'            \"city\": \"San Francisco\",'+
		'            \"state\": \"CA\",'+
		'            \"country\": \"United States\",'+
		'            \"zip\": \"94110\",'+
		'            \"latitude\": 37.756441680648,'+
		'            \"longitude\": -122.42122313109'+
		'         },'+
		'         \"id\": \"145768288146\"'+
		'      }'+
		'   ],'+
		'   \"paging\": {'+
		'      \"next\": \"https://graph.facebook.com/search?q=coffee&type=place&center=37.76,-122.427&distance=1000&access_token=AAAAAAITEghMBAMTYcZC1XzmuNM1H7MY5aoZAFfMa8s3B1MGAR4D2szMf5ECDOfZC0YYeKkCRjGX2tzZBpBZAUFXRw7JZC451TFKouxHnRgKwZDZD&limit=25&offset=25&__after_id=165097982486\"'+
		'   }'+
		'}';
		FacebookPlaces r = parse(json);
		System.assert(r != null);
		System.assert(r.data != null);
		System.assert(r.paging != null);

		FacebookUtil.testmode = true;
		FacebookUtil.teststubresponse = json;
		r = new FacebookPlaces('TEST', 'TEST');
		System.assert(r != null);
		System.assert(r.data != null);
		System.assert(r.paging != null);

		r = search('TEST', 'TEST');
		System.assert(r != null);
		System.assert(r.data != null);
		System.assert(r.paging != null);

		json = '{\"TestAMissingObject\": { \"TestAMissingArray\": [ { \"TestAMissingProperty\": \"Some Value\" } ] } }';
		FacebookPlaces objRoot = new FacebookPlaces(System.JSON.createParser(json));
		System.assert(objRoot != null);
		System.assert(objRoot.data == null);
		System.assert(objRoot.paging == null);
	}
}